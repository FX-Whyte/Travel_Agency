<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Travel Agency</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <img src="logo/logo4.png" alt="Travel Agency Logo" class="main-logo">
        </div>
        <ul class="nav-links">
            <li><a href="index.html#home">Home</a></li>
            <li><a href="index.html#howitworks">How it works</a></li>
            <li><a href="index.html#testimonials">Testimonials</a></li>
            <li><a href="index.html#pricing">Pricing</a></li>
            <li><a href="index.html#faq">faq</a></li>
        </ul>
        <div class="toggle-container" aria-hidden="true">
            <input type="checkbox" id="good" class="toggle">
            <label for="good" class="label">
                <div class="ball"></div>
            </label>
        </div>
    </nav>

    <div class="main-wrapper">
        <section class="signup-section">
            <h2>Create Your Account</h2>
            <form class="signup-form" autocomplete="off">
                <div class="row">
                    <div>
                        <label for="signup-firstname">First Name</label>
                        <input type="text" id="signup-firstname" name="firstname" required placeholder="First Name">
                    </div>
                    <div>
                        <label for="signup-surname">Surname</label>
                        <input type="text" id="signup-surname" name="surname" required placeholder="Surname">
                    </div>
                </div>
                <div>
                    <label for="signup-dob">Date of Birth</label>
                    <input type="date" id="signup-dob" name="dob" required>
                </div>
                <div>
                    <label for="signup-gender">Gender</label>
                    <select id="signup-gender" name="gender" required>
                        <option value="" disabled selected>Select gender</option>
                        <option value="female">Female</option>
                        <option value="male">Male</option>
                        <option value="other">Other</option>
                        <option value="prefer_not_say">Prefer not to say</option>
                    </select>
                </div>
                <div>
                    <label for="signup-email">Email</label>
                    <input type="email" id="signup-email" name="email" required placeholder="Email">
                </div>
                <div>
                    <label for="signup-password">Password</label>
                    <div style="position:relative;">
                        <input type="password" id="signup-password" name="password" required placeholder="Password" style="padding-right:40px;">
                        <button type="button" id="toggle-password" style="position:absolute; right:5px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; padding:0; width:28px; height:28px;">
                            <span id="eye-show-signup" style="display:inline;">
                                <!-- Eye SVG (show) -->
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <ellipse cx="12" cy="12" rx="9" ry="5"></ellipse>
                                    <circle cx="12" cy="12" r="2"></circle>
                                </svg>
                            </span>
                            <span id="eye-hide-signup" style="display:none;">
                                <!-- Eye-slash SVG (hide) -->
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M1 1l22 22"></path>
                                    <ellipse cx="12" cy="12" rx="9" ry="5"></ellipse>
                                    <circle cx="12" cy="12" r="2"></circle>
                                </svg>
                            </span>
                        </button>
                    </div>
                    <div id="password-strength" style="margin-top:5px; font-size:0.95em;"></div>
                </div>
                <div>
                    <label for="signup-confirm-password">Confirm Password</label>
                    <div style="position:relative;">
                        <input type="password" id="signup-confirm-password" name="confirm_password" required placeholder="Confirm Password" style="padding-right:40px;">
                        <button type="button" id="toggle-confirm-password" style="position:absolute; right:5px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; padding:0; width:28px; height:28px;">
                            <span id="eye-show-confirm" style="display:inline;">
                                <!-- Eye SVG (show) -->
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <ellipse cx="12" cy="12" rx="9" ry="5"></ellipse>
                                    <circle cx="12" cy="12" r="2"></circle>
                                </svg>
                            </span>
                            <span id="eye-hide-confirm" style="display:none;">
                                <!-- Eye-slash SVG (hide) -->
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M1 1l22 22"></path>
                                    <ellipse cx="12" cy="12" rx="9" ry="5"></ellipse>
                                    <circle cx="12" cy="12" r="2"></circle>
                                </svg>
                            </span>
                        </button>
                    </div>
                </div>
                <button type="submit" class="signup-btn">Sign Up</button>
                <div id="signup-message" style="margin-top:10px;color:#d32f2f;font-weight:500;"></div>
            </form>

            <!-- Success Message (place right after the form) -->
            <div id="signup-success" style="display:none;
                margin:30px auto;
                max-width:400px;
                background:#e8f5e9;
                color:#388e3c;
                border:1px solid #c8e6c9;
                border-radius:6px;
                padding:20px;
                text-align:center;
                font-size:1.2em;"></div>

            <!-- Verification Modal -->
            <div id="verify-modal" style="display:none; 
                position:fixed; top:0; 
                left:0; width:100vw; 
                height:100vh; 
                background:rgba(0,0,0,0.5); 
                z-index:1000; 
                align-items:center; 
                justify-content:center;">
                <div style="background:#fff; 
                    padding:2rem; 
                    border-radius:8px; 
                    max-width:350px; 
                    margin:auto; 
                    box-shadow:0 2px 16px rgba(0,0,0,0.2); 
                    text-align:center;">
                    <h3>Email Verification</h3>
                    <p>A verification code was sent to your email.<br>Enter it below:</p>
                    <input type="text" id="verify-code-input" maxlength="6" style="padding:8px; 
                        width:80%; 
                        margin:10px 0; 
                        font-size:1.1em;">
                    <div id="verify-error" style="color:#d32f2f; min-height:20px;"></div>
                    <button id="verify-submit-btn" style="margin-top:10px; 
                            padding:8px 20px; 
                            background:#1976d2; color:#fff; 
                            border:none; border-radius:4px; cursor:pointer;">Verify</button>
                    <button id="verify-cancel-btn" style="margin-top:10px; 
                            padding:8px 20px; 
                            background:#eee; 
                            color:#333; 
                            border:none; 
                            border-radius:4px; 
                            cursor:pointer; 
                            margin-left:10px;">Cancel</button>
                </div>
            </div>

            <div class="signup-link" style="margin-top:20px;">
                Already have an account? <a href="login.html">Log in</a>
            </div>
        </section>
    </div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Hide the toggle button instantly for signup page
    var toggle = document.querySelector('.toggle-container');
    if (toggle) {
        toggle.style.transition = "opacity 0.05s";
        toggle.style.opacity = '0';
        toggle.style.pointerEvents = 'none';
    }

    const form = document.querySelector('.signup-form');
    const signupBtn = document.querySelector('.signup-btn');
    const messageDiv = document.getElementById('signup-message');
    const verifyModal = document.getElementById('verify-modal');
    const verifyInput = document.getElementById('verify-code-input');
    const verifySubmitBtn = document.getElementById('verify-submit-btn');
    const verifyCancelBtn = document.getElementById('verify-cancel-btn');
    const verifyError = document.getElementById('verify-error');
    const signupSuccess = document.getElementById('signup-success');
    const passwordInput = document.getElementById('signup-password');
    const strengthDiv = document.getElementById('password-strength');
    const togglePassword = document.getElementById('toggle-password');
    const toggleConfirmPassword = document.getElementById('toggle-confirm-password');
    const confirmPasswordInput = document.getElementById('signup-confirm-password');
    // Modern password view toggle for signup password
    const eyeShowSignup = document.getElementById('eye-show-signup');
    const eyeHideSignup = document.getElementById('eye-hide-signup');
    if (togglePassword && passwordInput) {
        togglePassword.addEventListener('click', function(e) {
            e.preventDefault();
            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';
            eyeShowSignup.style.display = isPassword ? 'none' : 'inline';
            eyeHideSignup.style.display = isPassword ? 'inline' : 'none';
        });
    }
    // Modern password view toggle for confirm password
    const eyeShowConfirm = document.getElementById('eye-show-confirm');
    const eyeHideConfirm = document.getElementById('eye-hide-confirm');
    if (toggleConfirmPassword && confirmPasswordInput) {
        toggleConfirmPassword.addEventListener('click', function(e) {
            e.preventDefault();
            const isPassword = confirmPasswordInput.type === 'password';
            confirmPasswordInput.type = isPassword ? 'text' : 'password';
            eyeShowConfirm.style.display = isPassword ? 'none' : 'inline';
            eyeHideConfirm.style.display = isPassword ? 'inline' : 'none';
        });
    }

    // Password strength meter
    function checkPasswordStrength(password) {
        let strength = 0;
        if (password.length >= 8) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;

        if (password.length === 0) {
            return {text: '', color: ''};
        } else if (strength <= 2) {
            return {text: 'Weak password', color: '#d32f2f'};
        } else if (strength === 3 || strength === 4) {
            return {text: 'Medium strength', color: '#fbc02d'};
        } else {
            return {text: 'Strong password', color: '#388e3c'};
        }
    }

    passwordInput.addEventListener('input', function() {
        const result = checkPasswordStrength(passwordInput.value);
        strengthDiv.textContent = result.text;
        strengthDiv.style.color = result.color;
    });

    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        // Clear previous messages
        messageDiv.textContent = "";
        signupSuccess.style.display = "none";

        // Password match validation
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        if (password !== confirmPassword) {
            messageDiv.textContent = "Passwords do not match!";
            return;
        }

        // Password strength validation
        const passwordStrength = checkPasswordStrength(password);
        if (passwordStrength.text === 'Weak password') {
            messageDiv.textContent = "Please choose a stronger password.";
            return;
        }

        if (password.length < 6) {
            messageDiv.textContent = "Password should be at least 6 characters.";
            return;
        }

        // Collect form data into an object
        const data = {
            firstname: document.getElementById('signup-firstname').value,
            surname: document.getElementById('signup-surname').value,
            dob: document.getElementById('signup-dob').value,
            gender: document.getElementById('signup-gender').value,
            email: document.getElementById('signup-email').value,
            password: password
        };

        // Disable button to prevent double submit
        signupBtn.disabled = true;
        signupBtn.textContent = "Signing Up...";

        try {
            // Send the data to the Node.js backend using fetch
            const res = await fetch('http://localhost:4000/api/signup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await res.json();

            if (res.ok) {
                // Show verification modal
                verifyModal.style.display = "flex";
                verifyInput.value = "";
                verifyError.textContent = "";

                // Handle verification submit
                verifySubmitBtn.onclick = async function() {
                    const code = verifyInput.value.trim();
                    if (!code) {
                        verifyError.textContent = "Please enter the code.";
                        return;
                    }
                    verifySubmitBtn.disabled = true;
                    verifyError.textContent = "Verifying...";
                    try {
                        const verifyRes = await fetch('http://localhost:4000/api/verify', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ email: data.email, code })
                        });
                        const verifyResult = await verifyRes.json();
                        verifySubmitBtn.disabled = false;
                        if (verifyRes.ok) {
                            verifyModal.style.display = "none";
                            signupSuccess.textContent = "You're welcome, verification successful! You can now log in.";
                            signupSuccess.style.display = "block";
                            form.reset();
                            // Scroll to the success message for visibility
                            signupSuccess.scrollIntoView({ behavior: "smooth" });
                        } else {
                            verifyError.textContent = verifyResult.message;
                        }
                    } catch (err) {
                        verifyError.textContent = "Network error. Please try again.";
                        verifySubmitBtn.disabled = false;
                    }
                };

                // Handle verification cancel
                verifyCancelBtn.onclick = function() {
                    verifyModal.style.display = "none";
                    signupBtn.disabled = false;
                    signupBtn.textContent = "Sign Up";
                };
            } else {
                messageDiv.textContent = result.message;
            }
        } catch (err) {
            messageDiv.textContent = "Network error. Please try again later.";
        } finally {
            signupBtn.disabled = false;
            signupBtn.textContent = "Sign Up";
        }
    });
});
</script>

<div class="footer-copyright">
    &copy; Dev'FxWhyte
</div>

</body>
</html>